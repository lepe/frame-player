var FramePlayer=function(e,t){this.divCont=document.getElementById(e),this.elem=e,this.jsonVideoSrc=this.divCont.getAttribute("data-vidsrc"),this.rate=20,this.controls=!0,this.paused=!1,this.width="480px",this.height="320px",this.backwards=!1,this.currentFrame=-1,this.startFrame=0,this.radius=null,this.setOptions(t),this.initializeRequestAnimationFrame(),this.img=document.createElement("img"),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.divCont.appendChild(this.canvas)};FramePlayer.prototype.setOptions=function(e){if("rate"in e&&(this.rate=this._rate=e.rate),"controls"in e&&(this.controls=e.controls),"autoplay"in e&&(e.autoplay||(this.paused=!0)),"width"in e&&(this.width=e.width),"height"in e&&(this.height=e.height),"startFrame"in e&&(this.startFrame=this.currentFrame=e.startFrame),"backwards"in e&&(this.backwards=e.backwards),"isSpin"in e&&(this.isSpin=e.isSpin),"radius"in e){var t=document.createElement("style");t.setAttribute("id","style-"+this.elem),t.innerHTML="#"+this.elem+", .frames-"+this.elem+"{ border-radius: "+e.radius+"; overflow: hidden;}",document.head.appendChild(t)}this.divCont.style.width=this.width,this.divCont.style.height=this.height,this.controls&&this.createControlBar()},FramePlayer.prototype.render=function(e){var t,a,i=Date.now(),r=1e3/e.rate,n=e.jsonVideoFile.frames.length,s=1,o=!0;33.3>r&&(s=Math.round(33.3/r),r=33.3),this._fps=s;var l=function(){if(t=Date.now(),a=t-i,a>r||o){if(o=!1,i=t-a%r,e.paused)return;e.currentFrame=e.backwards?e.currentFrame-=1*s:e.currentFrame+=1*s;var d=e.playToFrame&&(e.currentFrame===e.playToFrame||Math.abs(e.currentFrame-e.playToFrame)<e._fps+1);if(d&&(e.currentFrame=e.playToFrame),e.currentFrame>=n?e.currentFrame=0:e.currentFrame<0&&(e.currentFrame=n-1),e.drawFrame(e),d)return e.paused=!0,e.playToFrame=0,void $(e).trigger("paused")}window.requestAnimationFrame(l)};window.requestAnimationFrame(l)},FramePlayer.prototype.drawFrame=function(e){e.img.src=e.jsonVideoFile.frames[e.currentFrame],e.context.drawImage(e.img,0,0,e.canvas.width,e.canvas.height)},FramePlayer.prototype.createControlBar=function(){var e=this,t=document.createElement("div");t.setAttribute("class","fp-ctrl"),t.style.width=this.width;var a=document.createElement("button");a.setAttribute("id","pause-"+e.elem),a.setAttribute("class","fp-btn"),a.innerHTML="Pause",a.addEventListener("click",function(){e.pause()},!1),t.appendChild(a);var i=document.createElement("button");i.setAttribute("id","play-"+e.elem),i.setAttribute("class","fp-btn"),i.innerHTML="Play",i.addEventListener("click",function(){e.resume()},!1),t.appendChild(i);var r=document.createElement("button");r.setAttribute("id","backwards-"+e.elem),r.setAttribute("class","fp-btn"),r.innerHTML="Backward",r.addEventListener("click",function(){e.reverse()},!1),t.appendChild(r),e.paused?a.style.display="none":i.style.display="none";for(var n=document.createElement("select"),s=["normal","grayscale","sepia","invert"],o=0,l=s.length;l>o;o++){var d=document.createElement("option");d.setAttribute("value",s[o]),d.innerHTML=s[o],n.appendChild(d)}n.setAttribute("id","filter-"+e.elem),n.setAttribute("class","fp-select"),n.addEventListener("change",function(){e.setFilter(this.value)},!1),t.appendChild(n);var m=document.createElement("label"),c=document.createElement("input"),u=document.createElement("input");m.className="to-frame",c.type="text",c.name="frame",c.value=e.startFrame,c.className="to-frame",e.toFrameInput=c,u.type="submit",u.value="go to frame",u.onclick=function(){value=parseInt(c.value,10),e.gotoFrame(value)},m.appendChild(c),m.appendChild(u),t.appendChild(m),this.divCont.appendChild(t)},FramePlayer.prototype.play=function(){this._isLoading||(this._isLoading=!0,this.getFile(this.jsonVideoSrc,function(e){e.paused?(e.render(e),e.drawFrame(e)):e.render(e)}))},FramePlayer.prototype.playTo=function(e){this.playToFrame=e;var t;if(this.isSpin)var a=this.jsonVideoFile.frames.length-1,i=Math.abs(e-this.currentFrame),r=Math.abs(a+e-this.currentFrame),t=i>r;else t=!1;e<this.currentFrame&&(t=!t),this.backwards=t;var n=this._rate;this.rate=!this.isSpin&&this.backwards?2*n:n,this.paused=!1,this.render(this)},FramePlayer.prototype.resume=function(){var e=document.getElementById("play-"+this.elem),t=document.getElementById("pause-"+this.elem);e.style.display="none",t.style.display="block",this.paused=!1},FramePlayer.prototype.pause=function(){var e=document.getElementById("play-"+this.elem),t=document.getElementById("pause-"+this.elem);e.style.display="block",t.style.display="none",this.paused=!0},FramePlayer.prototype.reverse=function(){var e=document.getElementById("backwards-"+this.elem);this.backwards=!this.backwards,value=this.backwards?"Forward":"Backward",e.innerHTML=value},FramePlayer.prototype.gotoFrame=function(e){e===parseInt(e,10)&&(this.currentFrame=this.startFrame=this.toFrameInput.value=e,void 0===this.jsonVideoFile?this.play():this.drawFrame(this))},FramePlayer.prototype.setFilter=function(e){var t=document.querySelector("#"+this.elem+" canvas");switch(e){case"normal":t.setAttribute("class","");break;case"grayscale":t.setAttribute("class","fp-grayscale");break;case"sepia":t.setAttribute("class","fp-sepia");break;case"invert":t.setAttribute("class","fp-invert")}},FramePlayer.prototype.getFile=function(e,t){var a=new XMLHttpRequest,i=this,r=document.createElement("p");if(!a)throw"Error loading file.";a.open("GET",e,!0),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.send(null),a.onprogress=function(){r.innerHTML="Loading...",r.setAttribute("class","fp-loading"),i.divCont.appendChild(r)},void 0!==typeof a.onload?a.onload=function(){i.divCont.removeChild(r),i.jsonVideoFile=JSON.parse(this.responseText),t(i),a=null}:a.onreadystatechange=function(){4===a.readyState&&(i.divCont.removeChild(r),i.jsonVideoFile=JSON.parse(this.responseText),t(i),a=null)}},FramePlayer.prototype.initializeRequestAnimationFrame=function(){for(var e=0,t=["ms","moz","webkit","o"],a=0;a<t.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[t[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[a]+"CancelAnimationFrame"]||window[t[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,a){var i=(new Date).getTime(),r=Math.max(0,16-(i-e)),n=window.setTimeout(function(){t(i+r)},r);return e=i+r,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})};