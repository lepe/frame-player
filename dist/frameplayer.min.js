const FramePlayer=function(e,t){this.divCont=document.getElementById(e),this.elem=e,this.jsonVideoSrc=this.divCont.getAttribute("data-vidsrc"),this.rate=20,this.controls=!0,this.paused=!1,this.width="480px",this.height="320px",this.backwards=!1,this.currentFrame=-1,this.startFrame=0,this.radius=null,this.onFinish=function(){},this.setOptions(t),this.initializeRequestAnimationFrame(),this.img=document.createElement("img"),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.divCont.appendChild(this.canvas)};FramePlayer.prototype.setOptions=function(e){if("rate"in e&&(this.rate=this._rate=e.rate),"controls"in e&&(this.controls=e.controls),"autoplay"in e&&(e.autoplay||(this.paused=!0)),"width"in e&&(this.width=e.width),"height"in e&&(this.height=e.height),"startFrame"in e&&(this.startFrame=this.currentFrame=e.startFrame),"backwards"in e&&(this.backwards=e.backwards),"isSpin"in e&&(this.isSpin=e.isSpin),"radius"in e){const t=document.createElement("style");t.setAttribute("id","style-"+this.elem),t.innerHTML="#"+this.elem+", .frames-"+this.elem+"{ border-radius: "+e.radius+"; overflow: hidden;}",document.head.appendChild(t)}this.divCont.style.width=this.width,this.divCont.style.height=this.height,this.controls&&this.createControlBar()},FramePlayer.prototype.render=function(e){let t,i,n=Date.now(),a=1e3/e.rate,s=e.jsonVideoFile.frames.length,r=!0;this._fps=1;const o=function(){if(t=Date.now(),i=t-n,i>a||r){if(r=!1,n=t-i%a,e.paused)return;{e.currentFrame=e.backwards?e.currentFrame-=1:e.currentFrame+=1;const t=e.playToFrame&&(e.currentFrame===e.playToFrame||Math.abs(e.currentFrame-e.playToFrame)<e._fps+1);if(t&&(e.currentFrame=e.playToFrame),e.currentFrame>=s?e.currentFrame=0:e.currentFrame<0&&(e.currentFrame=s-1),e.drawFrame(e),t)return e.paused=!0,e.playToFrame=0,void e.onFinish()}}window.requestAnimationFrame(o)};window.requestAnimationFrame(o)},FramePlayer.prototype.drawFrame=function(e){e.img.src=e.jsonVideoFile.frames[e.currentFrame],e.context.drawImage(e.img,0,0,e.canvas.width,e.canvas.height)},FramePlayer.prototype.createControlBar=function(){const e=this,t=document.createElement("div");t.setAttribute("class","fp-ctrl"),t.style.width=this.width;const i=document.createElement("button");i.setAttribute("id","pause-"+e.elem),i.setAttribute("class","fp-btn"),i.innerHTML="Pause",i.addEventListener("click",(function(){e.pause()}),!1),t.appendChild(i);const n=document.createElement("button");n.setAttribute("id","play-"+e.elem),n.setAttribute("class","fp-btn"),n.innerHTML="Play",n.addEventListener("click",(function(){e.resume()}),!1),t.appendChild(n);const a=document.createElement("button");a.setAttribute("id","backwards-"+e.elem),a.setAttribute("class","fp-btn"),a.innerHTML="Backward",a.addEventListener("click",(function(){e.reverse()}),!1),t.appendChild(a),e.paused?i.style.display="none":n.style.display="none";const s=document.createElement("select"),r=["normal","grayscale","sepia","invert"];let o=0,l=r.length;for(;o<l;o++){const e=document.createElement("option");e.setAttribute("value",r[o]),e.innerHTML=r[o],s.appendChild(e)}s.setAttribute("id","filter-"+e.elem),s.setAttribute("class","fp-select"),s.addEventListener("change",(function(){e.setFilter(this.value)}),!1),t.appendChild(s);const c=document.createElement("label"),d=document.createElement("input"),m=document.createElement("input");c.className="to-frame",d.type="text",d.name="frame",d.value=e.startFrame,d.className="to-frame",e.toFrameInput=d,m.type="submit",m.value="go to frame",m.onclick=function(){let t=parseInt(d.value,10);e.gotoFrame(t)},c.appendChild(d),c.appendChild(m),t.appendChild(c),this.divCont.appendChild(t)},FramePlayer.prototype.play=function(){if(this._isLoading)return;this._isLoading=!0;const e=function(e){e.paused?(e.render(e),e.drawFrame(e)):e.render(e)};if("_jsonVideo"in window&&this.jsonVideoSrc in window._jsonVideo){const t=window._jsonVideo[this.jsonVideoSrc];this.jsonVideoFile=JSON.parse(t),e(this)}else this.getFile(this.jsonVideoSrc,e)},FramePlayer.prototype.playTo=function(e){let t;if(this.playToFrame=e,this.isSpin){const i=this.jsonVideoFile.frames.length-1;t=Math.abs(e-this.currentFrame)>Math.abs(i+e-this.currentFrame)}else t=!1;e<this.currentFrame&&(t=!t),this.backwards=t;const i=this._rate;this.rate=!this.isSpin&&this.backwards?2*i:i,this.paused=!1,this.render(this)},FramePlayer.prototype.resume=function(){const e=document.getElementById("play-"+this.elem),t=document.getElementById("pause-"+this.elem);e&&(e.style.display="none"),t&&(t.style.display="block"),this.paused=!1},FramePlayer.prototype.pause=function(){const e=document.getElementById("play-"+this.elem),t=document.getElementById("pause-"+this.elem);e&&(e.style.display="block"),t&&(t.style.display="none"),this.paused=!0},FramePlayer.prototype.reverse=function(){const e=document.getElementById("backwards-"+this.elem);this.backwards=!this.backwards;let t=this.backwards?"Forward":"Backward";e.innerHTML=t},FramePlayer.prototype.gotoFrame=function(e){e===parseInt(e,10)&&(this.currentFrame=this.startFrame=this.toFrameInput.value=e,void 0===this.jsonVideoFile?this.play():this.drawFrame(this))},FramePlayer.prototype.setFilter=function(e){const t=document.querySelector("#"+this.elem+" canvas");switch(e){case"normal":t.setAttribute("class","");break;case"grayscale":t.setAttribute("class","fp-grayscale");break;case"sepia":t.setAttribute("class","fp-sepia");break;case"invert":t.setAttribute("class","fp-invert")}},FramePlayer.prototype.getFile=function(e,t){let i=new XMLHttpRequest,n=this,a=document.createElement("p");if(!i)throw"Error loading file.";i.open("GET",e,!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(null),i.onprogress=function(){a.innerHTML="Loading...",a.setAttribute("class","fp-loading"),n.divCont.appendChild(a)},void 0!==typeof i.onload?i.onload=function(){n.divCont.removeChild(a),n.jsonVideoFile=JSON.parse(this.responseText),t(n),i=null}:i.onreadystatechange=function(){4===i.readyState&&(n.divCont.removeChild(a),n.jsonVideoFile=JSON.parse(this.responseText),t(n),i=null)}},FramePlayer.prototype.initializeRequestAnimationFrame=function(){let e=0;const t=["ms","moz","webkit","o"];for(let e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){const i=(new Date).getTime(),n=Math.max(0,16-(i-e)),a=window.setTimeout((function(){t(i+n)}),n);return e=i+n,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})};